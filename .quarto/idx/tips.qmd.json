{"title":"そのためメモ","markdown":{"headingText":"そのためメモ","containsRefs":false,"markdown":"\n便利だが普段はあまりつかわないため忘れがちな点についてメモしておく．\n本テキストのどこかで扱う内容もメモする．\n\n\n## 文字列の処理\n\n```{r}\nlibrary(tidyverse)\nlibrary(stringr)\n```\n\n```{r}\nfruit\n# 長さ\nstr_length(fruit)\n# くっつける\nstr_c(\"fruit_\", fruit)\n# パターンの数\nstr_count(fruit, \"[a-b]\")\n# パターンの発見\nstr_detect(fruit, \"[a-b]\")\n# 繰り返す\nstr_dup(letters, 5)\n# 終わる\nfruit[str_ends(fruit, \"a\")]\n# 同じ\nstr_equal(fruit, \"banana\")\n# エスケープ\nstr_escape(\"^\")\nstr_extract(fruit, \"[a-c]\")\nstr_extract(fruit, \"b[a-n]\")\nstr_extract_all(fruit, \"apple\", simplify = TRUE)\n\nstr_detect(c(\"a\", \".\"), str_escape(\".\"))\n\n\nx <- \"Hello, World!\"\nstr_extract_all(x, boundary(\"character\"), simplify = TRUE)\nstr_extract_all(x, boundary(\"line_break\"), simplify = TRUE)\nstr_extract_all(x, boundary(\"sentence\"), simplify = TRUE)\nstr_extract_all(x, boundary(\"word\"), simplify = TRUE)\n\n\nstr_flatten(fruit)\nstr_flatten_comma(fruit)\nstr_glue(\"I bought \", \"{fruit}\", \" by {rnorm(length(fruit), mean = 100, sd = 10) |> format(digits = 3)} yen\")\n\nstarwars |> str_glue_data(\"Is {height} over 100? {ifelse(height >= 100, 'Yes','No')}.\")\n\nx <- c(NA,\"a\",\"b\",\"c\",NA)\nx\nstr_c(\"fruit_\", x)\nstr_c(\"fruit_\", str_replace_na(x, replacement = \"DKNA\"))\n\n\nstr_to_lower(LETTERS)\nstr_sub(fruit, 1, 1) <- str_to_upper(str_sub(fruit, 1, 1))\nfruit\n\n\nstr_to_upper(\"gender\")\nstr_to_upper(\"全角のａ\")\n\nstr_to_lower(\"ESTSIMATE\")\nstr_to_lower(\"Ａ\")\n\nstr_view(fruit, \"a\")\nstr_view(fruit, \"[ae]\")\nstr_view(fruit, \".a.\")\nstr_view(fruit, \"^A\")\nstr_view(fruit, \"a$\")\nstr_view(fruit, \".a.|.b.\")\n```\n\n\n```{r}\nstr_view(words, \"^y\")\nstr_view(words, \"x$\")\nstr_view(words, \"^...$\")\nstr_view(words, \"^*.......*$\")\nstr_view(words, \"[^a-u]\")\nstr_view(words, \"a|b\")\nstr_view(words, \"(a|b)\")\n```\n\n\n## 正規表現（regular expression）\n\n- extended regular expressions (the default)\n- Perl-like regular expressions\n- literal regular expressions\n\nメタキャラクター：`. \\ | ( ) [ { ^ $ * + ?`\n\n\n```{r}\nletters\ngrep(\"j|k\", fruit)\ngrep(\"[jk]\", fruit)\ngrepl(\"j|k\", fruit)\ngrepl(\"[jk]\", fruit)\nsub(\"[jk]\",\"XXXXX\", fruit)\ngsub(\"[jk]\",\"XXXXX\", fruit)\n\nx <- \"Hello World!\"\n\n# 文頭\ngrepl(\"^e\", x)\ngrepl(\"^H\", x)\ngrepl(\"^h\", x)\n\n# 文末\ngrepl(\"d$\", x)\ngrepl(\"!$\", x)\n\n# いずれか\ngrepl(\"[!]\", x)\ngrepl(\"[a]\", x)\ngrepl(\"[A-Za-z0-9]\", \"!!!!!\")\ngrepl(\"[A-Za-z0-9]\", \"99999\")\ngrepl(\"[A-Za-z0-9]\", \"#####\")\ngrepl(\"[A-Za-z0-9]\", \"####1#\")\n\n# グルーピング\ngrepl(\"(e)\", x)\ngrepl(\"(e) +(d)\", x)\ngrepl(\"(e)+(w)\", x)\ngrepl(\"(H)(e)\", x)\ngrepl(\"(H)(l)\", x)\n\n\n\ngrep(\"[e]\", x)\ngrepl(\"[e]\", x)\ngrepl(\"e\", x)\ngrepl(\"l|k\", x)\ngrepl(\"e\", x)\ngrepl(\"h\", x)\ngrepl(\".\", x)\n\ngrep(\"[e]\", letters)\ngrepl(\"[e]\", letters)\ngrepl(\"e\", letters)\ngrepl(\"l|k\", letters)\ngrepl(\"e\", letters)\ngrepl(\"h\", letters)\ngrepl(\".\", letters)\n```\n\n```{r}\nlibrary(tidyverse)\nstarwars$name[grepl(\"aa|[k]\", starwars$name)]\n```\n\n\n## any_of, all_of\n\n変数名をオブジェクトとして用いるときに便利．\n\n```{r}\nselect_vars <- c(\"height\", \"mass\")\nstarwars |> select(select_vars) \nstarwars |> select(any_of(select_vars))\n```\n\n\n## map\n\n```{r}\nlibrary(purrr)\nx <- 1:10\nsqrt(x)\nmap(x, sqrt)\nmap_vec(x, sqrt)\n```\n\nd <- d %>% mutate(gpa_std = (gpa_sum - mean(gpa_sum, na.rm = TRUE)) \n  / sd(gpa_sum, na.rm = TRUE))\n\n## 部分一致\n\n`data.frame`形式であれば`$`で変数名の部分一致が利用できるが，`tibble`形式ではできない．部分一致によってエラーが生じる可能性もあるので省略せずに入力するほうが良い．\n\n\n```{r}\nlibrary(tidyverse)\nstarwars\nstarwars$hei\nstarwars$ha\nstarwars_df <- as.data.frame(starwars) \nstarwars_df$hei\nstarwars_df$ha\n```\n\n\n## 因子\n\n```{r}\nx <- c(0,1,1,1,0)\ny <- factor(x)\ny\nstr(y)\nattributes(y)\nlevels(y)\nas.numeric(y)\nas.numeric(as.character(y))\n```\n\n\n## 集計データを個票データに変換する\n\n```{r}\n# クロス表\noccupationalStatus\n# 集計データ\ndata.frame(occupationalStatus)\n# 個票データ\ndf_occupationalStatus <- vcdExtra::expand.dft(data.frame(occupationalStatus), dreq = \"Freq\") |> \n  mutate(across(origin:destination, factor))\n# \ndf_occupationalStatus |> summary()\n```\n\n\n\n## 関数の中身を確認する\n\n`mean()`関数がどのようにして作成されているのかを確認したい場合，`mean`のように`()`をとって入力すればよい．しかし，`UseMethod(\"mean\")`のように関数が表示され，中身を確認できない場合もある．\n\n```{r}\nmean\n```\n\nこのような場合は，`methods()`関数を用いるとよい\n```{r}\nmethods(mean)\n```\n\n様々な結果が示されるがここでは，2めの要素にある`mean.default*`を確認しよう．`*`をとって`mean.default`と入力するだけでよい．\n\n```{r}\nmean.default\n```\n\n```{r}\ngetAnywhere(mean.default)\n```\n\n\n```{r}\nlibrary(DescTools)\nOddsRatio\nmethods(OddsRatio)\nDescTools:::OddsRatio.default\ngetAnywhere(OddsRatio.default)\n```\n\n\n## unname\n\nCramer's Vを`chisq.test()`の結果を利用して作成する．\nその際，`unname()`によってカイ2乗統計量の名前をとる．\n\n```{r}\noccupationalStatus\nchisq.test(occupationalStatus)\nX2 <- chisq.test(occupationalStatus)$statistic |> unname()\nX2\nmy_CramerV <- sqrt(X2/min(dim(occupationalStatus)-1)/sum(occupationalStatus))\nmy_CramerV\nDescTools::CramerV(occupationalStatus)\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"tips.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","bibliography":["references.bib"],"crossref":{"fig-title":"図","tbl-title":"表","title-delim":"："},"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}}}